<!DOCTYPE html>
<html class="x-admin-sm">
<head>
    <meta charset="utf-8">
    <title>
        敬老院服务管理-总览-操作-照护计划
    </title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" href="../css/font.css">
    <link rel="stylesheet" href="../css/index.css">
	<link rel="stylesheet" href="../../layui/css/layui.css">
    <script src="../lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../js/index.js"></script>
	<script type="text/javascript" src="./js/base.js"></script>
	<script type="text/javascript" src="../../js/base.js"></script>
</head>
<body>
	<div class="layui-card">
		<form class="layui-form layui-form-pane" action="" id="nurse" lay-filter="nurse">
			<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
				
				<div class="layui-tab-item layui-show">
					<br>
					<div class="layui-row layui-col-space5">
						<div class="layui-col-xs1 layui-col-sm1 layui-col-md1">
							<button class="layui-btn layui-btn-radius layui-btn-normal layui-btn-fluid layui-hide"  type="button" id="print" lay-filter="print" onclick="onPrint();">打印健康表</button>
						</div>
					</div>

					<div class="layui-form-item">
						<div class="layui-row">
							<div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
								<label class="layui-form-label">姓名</label>
								<div class="layui-input-block">
									<input type="text" id="name" disabled="disable" autocomplete="off" value="" class="layui-input">
								</div>
							</div>
							<div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
								<label class="layui-form-label">身份证号</label>
								<div class="layui-input-block">
									<input type="text" id="chinaid" disabled="disable" autocomplete="off" value="" class="layui-input">
								</div>
							</div>
							<div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
								<label class="layui-form-label">性别</label>
								<div class="layui-input-block">
									<input type="text" id="sex" disabled="disable" autocomplete="off" value="" class="layui-input">
								</div>
							</div>
						</div>
						
						<div class="layui-row">
							<div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
								<label class="layui-form-label">能力等级</label>
								<div class="layui-input-block">
									<input type="text" id="capability" disabled="disable" autocomplete="off" value="" class="layui-input">
								</div>
							</div>
							<div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
								<label class="layui-form-label"><span class='x-red'>*</span>护理等级</label>
								<div class="layui-input-block">
									<select name="level" id="level" lay-filter="level" lay-verify="required">
										<option value="">---请选择护理等级---</option>
										<option value="1">I级</option>
										<option value="2">II级</option>
										<option value="3">III级</option>
										<option value="4">IV级</option>
										<option value="5">特级</option>
									</select>
								</div>
							</div>
							<div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
								<label class="layui-form-label">
									<span class='x-red'>*</span>入住日期
								</label>
								<div class="layui-input-block">
									<input type="text" lay-verify="required" name="date" id="date" autocomplete="off" value="" class="layui-input">
								</div>
							</div>
						</div>
					</div>
					<fieldset class="layui-elem-field">
					  <legend class="layui-font-14"><span class='x-red'>*</span>服务项目</legend>
						<div class="layui-field-box">
                        	<textarea id="service" name="service" class="layui-textarea" lay-verify="required" style="height: 130pt;"></textarea>
						</div>
					</fieldset>
					<fieldset class="layui-elem-field">
					  <legend class="layui-font-14"><span class='x-red'>*</span>安全保障</legend>
						<div class="layui-field-box">
                        	<textarea id="safe" name="safe" class="layui-textarea" lay-verify="required">无</textarea>
						</div>
					</fieldset>
					<fieldset class="layui-elem-field">
					  <legend class="layui-font-14"><span class='x-red'>*</span>饮食照护</legend>
						<div class="layui-field-box">
                        	<textarea id="diet" name="diet" class="layui-textarea" lay-verify="required">普食</textarea>
						</div>
					</fieldset>
					<fieldset class="layui-elem-field">
					  <legend class="layui-font-14"><span class='x-red'>*</span>注意事项</legend>
						<div class="layui-field-box">
                        	<textarea id="heed" name="heed" class="layui-textarea" lay-verify="required">无</textarea>
						</div>
					</fieldset>
					<div class="layui-form-item">
						<div class="layui-row">
							<div class="layui-col-xs2 layui-col-sm2 layui-col-md2 layui-col-md-offset5 layui-col-sm-offset5 layui-col-xs-offset5">
								<button class="layui-btn layui-btn-fluid" type="button" lay-filter="add" lay-submit="">
									提交
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</form>
	</div>

	<script>
		Date.prototype.Format = function(fmt) {
			var o = {
				"M+": this.getMonth() + 1,
				"d+": this.getDate(),
				"H+": this.getHours(),
				"m+": this.getMinutes(),
				"s+": this.getSeconds(),
				"q+": Math.floor((this.getMonth()+3)/3),
				"S": this.getMilliseconds()
			};
			
			if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4-RegExp.$1.length))
			for (var k in o)
			if (new RegExp("("+k+")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1)?(o[k]):(("00"+o[k]).substr((""+o[k]).length)))
			return fmt;
		}
	</script>

	<script>

		// 通过url获取参数
		const params = new URLSearchParams(window.location.search);
		const idx = params.get('idx');
		const op = params.get('op');
		const sessiondata_key = "op-" + idx;

		let session_data;

		layui.use(['element','layer','form', 'laydate', 'table'], function(){
			var  $ = layui.jquery;//jquery
			var element = layui.element;//面包导航
			var layer = layui.layer;//弹出层
			var form = layui.form;
			var laydate = layui.laydate;
			var table = layui.table;
			session_data = layui.sessionData("jly-client-list")[sessiondata_key.toString()];
			init();

			var date= new Date();
			laydate.render({
				elem: '#date'
				,isInitValue: true
				,type: 'date'
				,value: op == "add" ? date : session_data.date
			});

			$.ajaxSetup({
				headers: {'Access-Control-Allow-Origin' : BasePathJLY,},
				xhrFields: {withCredentials: true},
			});

			form.on('select(level)', function (data) {
				console.log(data.value);
				switchDefaultSevice(data.value);
			});

			//监听提交
			form.on('submit(add)', function(data){
				data.field.client_idx = session_data.Idx;
				
				$.ajax({
					type: "post",
					url: BasePathJLY + '/addnurse',
					data: data.field,
					dataType: "json",
					headers: {'Access-Control-Allow-Origin' : BasePathJLY,},
					xhrFields: {withCredentials: true},
					success: function(data){
						console.log(data)
						if(data.code==0){
							layer.msg("注册成功", {icon: 6,time:2000},function () {
								window.parent.location.reload();
								var index = parent.layer.getFrameIndex(window.name);
								parent.layer.close(index);
							});
							return false;
						}else if(data.code==1001) {
							window.top.location.href = "../../index.html";
							return false;
						}else{
							layer.msg(data.msg,{icon:5,time:5000});
							return false;
						}
					}
				});
			});
		});

		function init() {
			// layui.form.val("nurse", {
			// 	name: session_data.Name,
			// 	chinaid: session_data.ChinaId,
			// 	sex: session_data.Sex,
			// })

			document.getElementById("name").value = session_data.Name;
			document.getElementById("chinaid").value = session_data.ChinaId;
			document.getElementById("sex").value = session_data.Sex;
			layui.form.render();
		}

		const services = {
			level_1 : [
				'提供膳食、定期清洗衣物及被褥。',
				'定期陪聊、定期测量需要、血糖等生命体征、提供日常文化娱乐。'].join("\r\n"),
			level_2 : [
				'协助起居、穿衣、洗漱等日常照料。',
				'提供康复治疗和训练。'].join("\r\n"),
			level_3 : ['辅助进餐、协助如厕、协助洗浴，提供医疗服务。'].join("\r\n"),
			level_4 : [
				'定时翻身、定期擦拭身体，防止压疮。',
				'提供心理支持与关怀。'].join("\r\n"),
			level_5 : ['24小时全程照料。为家属提供心理辅导和支撑。'].join("\r\n"),
  
		}

		function switchDefaultSevice(level) {
			let service_text = "";



			switch (level) {
				case "5":
					service_text = services.level_5 + "\r\n" + service_text;
				case "4":
					service_text = services.level_4 + "\r\n" + service_text;
				case "3":
					service_text = services.level_3 + "\r\n" + service_text;
				case "2":
					service_text = services.level_2 + "\r\n" + service_text;
				case "1":
					service_text = services.level_1 + "\r\n" + service_text;
					break;
				default:
					break;
			}
			document.getElementById("service").innerHTML = service_text;
		}

	</script>
</body>
</html>