<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>
        新建工单
    </title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/index.css">
    <script src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/index.js"></script>
	<script type="text/javascript" src="../js/base.js"></script>

    <!--<style>
        .imgs{display: none;}
        .picture{display: none;}
    </style>-->

    <!--百度编辑器
    <script src="./ueditor/ueditor.config.js"></script>
    <script src="./ueditor/ueditor.all.min.js"></script>
    <script src="./ueditor/lang/zh-cn/zh-cn.js"></script>
	-->
<style type="text/css">

</style>
</head>
<body>
	<style>
        .container{
            height: 80px;
            solid white;
			background: white;
        }
        .dot{
            border:10px solid #000000;
            width: 10px;
            height: 10px;
            border-radius: 100px;
            background: none;
            margin: AUTO;
            margin-bottom: -15px;
        }
		.dot1{
            border:10px solid #00ffff;
            width: 10px;
            height: 10px;
            border-radius: 100px;
            background: none;
            margin: AUTO;
            margin-bottom: -15px;
        }
        .item{
            flex:5;
            border-bottom:2px solid #cdcdcd;
        }
		.item1{
            flex:5;
            border-bottom:0px solid #cdcdcd;
        }
		.item2{
            flex:5;
            border-bottom:2px solid #ff0000;
        }
    </style>
	
	
<div class="layui-fluid">
		<form class="layui-form layui-form-pane" id="orderadd" lay-filter="orderadd">
			<div class="layui-form-item " data-filtered="filtered">
				<div data-filtered="filtered">
					<div class="layui-panel" data-filtered="filtered">
						<div style="padding: 30px;" data-filtered="filtered">
							<div class="container">
								<div style="display:flex;">
									<div style="flex:1;display:flex" id="dot_statue_1">
										<div style="flex:1"></div>
										<div class="dot"></div>
										<div class="item"></div>
									</div>
									<div style="flex:1;display:flex" id="dot_statue_2">
										<div class="item"></div>
										<div class="dot"></div>
										<div class="item"></div>
									</div>
									<div style="flex:1;display:flex" id="dot_statue_3">
										<div class="item"></div>
										<div class="dot"></div>
										<div class="flex:1"></div>
									</div>
								</div>
								<div style="display:flex;margin-top:25px;">
									<div style="flex:1;display:flex">
										<div style="flex:1"></div>
										<div class="">下单</div>
										<div class="item1"></div>
									</div>
									<div style="flex:1;display:flex">
										<div class="item1"></div>
										<div class="">已分派</div>
										<div class="item1"></div>
									</div>
									<div style="flex:1;display:flex">
										<div class="item1"></div>
										<div class="">已完成</div>
										<div class="flex:1"></div>
									</div>
								</div>
								<div style="display:flex;margin-top:5px;">
									<div style="flex:1;display:flex" id="time_statue_1">
									</div>
									<div style="flex:1;display:flex" id="time_statue_1">
									</div>
									<div style="flex:1;display:flex" id="time_statue_1">
									</div>
								</div>
							</div>
						</div>
					</div>   
				</div>
			</div>   
			<div class="layui-form-item">
				<div class="layui-row layui-col-space5">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="name" class="layui-form-label">老人</label>
						<div class="layui-input-block">
							<input type="text" id="name" disabled="disabled" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="phone" class="layui-form-label">联系方式
						</label>
						<div class="layui-input-block">
							<input type="text" id="phone" disabled="disabled" class="layui-input">
						</div>
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-row layui-col-space5">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="idx" class="layui-form-label">订单编号</label>
						<div class="layui-input-block">
							<input type="text" id="idx" disabled="disabled" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
						<label for="sex" class="layui-form-label">性别</label>
						<div class="layui-input-block">
							<input type="text" id="sex" disabled="disabled" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
						<label for="age" class="layui-form-label">年龄</label>
						<div class="layui-input-block">
							<input type="text" id="age" disabled="disabled" class="layui-input">
						</div>
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<label for="addr" class="layui-form-label">地址</label>
				<div class="layui-input-block">
					<input id="addr" name="addr" disabled="disabled" class="layui-input">
				</div>
			</div>
			<div class="layui-form-item" id="waiter_info_2">
				<div class="layui-row layui-col-space5">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="waiter" class="layui-form-label">
							<span class="x-red">*</span>服务人员</label>
						<div class="layui-input-block">
							<input type="text" id="waiter" disabled="disabled" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="waiter_phone" class="layui-form-label">联系电话</label>
						<div class="layui-input-block">
							<input type="text" class="layui-input" id="waiter_phone" disabled="disabled">
						</div>
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-row layui-col-space1">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="consumptiontype" class="layui-form-label">
								<span class="x-red">*</span>消费类型</label>
						<div class="layui-inline layui-show-xs-block">
                            <select name="consumptiontype" id="consumptiontype" lay-filter="consumptiontype">
							</select>
                        </div>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="charge" class="layui-form-label">
							<span class="x-red">*</span>参考价格</label>
						<div class="layui-input-block">
							<input type="text" id="charge" name="charge" required="" lay-verify="" disabled="disabled" class="layui-input">
						</div>
					</div>
				</div>
			</div>
			<div class="layui-form-item" id="fareself">
				<div class="layui-row layui-col-space1">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="fare" class="layui-form-label">
							</span>车费</label>
						<div class="layui-input-block">
							<input type="text" id="fare" name="fare" value="0" required="" lay-verify="number" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="highrise" class="layui-form-label">
							</span>高层费用</label>
						<div class="layui-input-block">
							<input type="text" id="highrise" name="highrise" value="0" required="" lay-verify="number" class="layui-input">
						</div>
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<button class="layui-btn layui-btn-fluid" lay-filter="add" lay-submit="">创建</button>
			</div>
		</form>
</div>

<script type="text/html" id="fieldtool">
  <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="delete">删除</a>
</script>

<!--工具栏模板-->
<script type="text/html" id="contactstools">
  <div class="layui-btn-group">
    <button class="layui-btn layui-btn-primary layui-btn layui-btn-sm" id="contacts_add">
		<i class="layui-icon"  style="font-size: 20px">&#xe61f;</i>
	</button>
	<!--<button class="layui-btn layui-btn-primary layui-btn layui-btn-sm" onclick="onRefresh();" lay-event="refresh"><i class="layui-icon"  style="font-size: 20px">&#xe669;</i></button>-->
  </div>
</script>

<script>

	var form;
    layui.use(['element','layer', 'form', 'table', 'laydate'], function(){
        var  $ = layui.jquery;//jquery
        var lement = layui.element;//面包导航
        var layer = layui.layer;//弹出层
        form = layui.form;
        var upload = layui.upload;
		var table = layui.table;
		var laydate = layui.laydate;
		
		init_ConsumptionType_select();

        //预约时间日期
		var date= new Date();
		var year = date.getFullYear();      //年
		var month = date.getMonth() + 1;    //月
		var strDate = date.getDate();       //日
		var hours = date.getHours();        //时
		var minutes = date.getMinutes();    //分
		laydate.render({
			elem: '#servicetime'
			,value: year+"-"+month+"-"+strDate+" "+hours+":"+minutes+":00"
			,isInitValue: true
			,type: 'datetime'
			,min: Date.now()
		});
		 
		var gloab = layui.data('yl-user');
		form.val("orderadd", {
			"handler": gloab.user["UserName"],
			}
		)
		
		form.on('select(consumptiontype)', function(data){
			console.log("data.value:"+data.value)
			if (data.value === "政府购买") {
				document.getElementById('fareself').style.display = 'none';
			} else if (data.value === "自费") {
				document.getElementById('fareself').style.display = 'block';
			}
		});      


        //监听提交
        form.on('submit(add)', function(data){	
			var back;
            $.ajax({
                type: "post",
                url: BasePath + '/addorder',
                data: data.field,
                dataType: "json",
				headers: {'Access-Control-Allow-Origin' : Domain,},
				xhrFields: {withCredentials: true},
                success: function(data){
					back = data
                    if(data.code==0){
						console.log("data.code==0")
                        layer.msg("注册成功", {icon: 6,time:2000},function () {
                            window.parent.location.reload();
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                        });
                    }else if(data.code==1001) {
						// cookie 失效
						var from = document.getElementById("from").value;
						if (from == "client-list") {
							parent.parent.location.href = "../index.html";
						} else {
							parent.location.href = "../index.html";
						}
					}else{
                        layer.msg(data.msg, {icon:5,time:5000});
                    }
                }
            });
			return false;
        });
		
    })
	
	function init_ConsumptionType_select() {		
		$.ajax({
			url: BasePath + "/getconsumptiontypes",
			type:"post",
			dataType:"json",
			headers: {'Access-Control-Allow-Origin' : Domain,},
			xhrFields: {withCredentials: true},
			success:function (data){
				if (data.code==0){
					for (var i=0;i<data.data[0].length;i++) {
						console.log(data.data[0][i]["Type"])
						$("#consumptiontype").append(new Option(data.data[0][i]["Type"], data.data[0][i]["Type"]))
					}
					form.render('select');	
					
					if ($('#consumptiontype option:selected').val() === "政府购买") {
						document.getElementById('fareself').style.display = 'none';
					} else {
						document.getElementById('fareself').style.display = 'block';
					}
				}
			}
		});
	}
	
	function onSelClient() {
		layer.open({
			type: 2,
			area: ['880px', '500px'],
			fixed: false, //不固定
			maxmin: true,
			title: "选择老人",
			content: 'client-select.html',
			success:function(layero,index){
				
			}
		});
	}
	
	function onSelService() {
		layer.open({
			type: 2,
			area: ['880px', '500px'],
			fixed: false, //不固定
			maxmin: true,
			title: "选择老人",
			content: 'service-select.html',
			success:function(layero,index){
			
			}
		});
	}
	
	function onSelWaiter() {
		layer.open({
			type: 2,
			area: ['880px', '500px'],
			fixed: false, //不固定
			maxmin: true,
			title: "选择服务人员",
			content: 'worker-select.html',
			success:function(layero,index){
			
			}
		});
	}
</script>

<script>
    function DoSelectClient(data) {
		form.val("orderadd", {
			name: data["Name"],
			phone: data["Phone"],
			ascription: data["Community"],
			addr: data["Addr"],
		})
	}
	
	function DoSelectService(data) {
		console.log(data)
		form.val("orderadd", {
			service: data["Name"],
			charge: data["Price"],
		})
	}
	
	/*
	function DoSelectWorker(data) {
		console.log(data)
		form.val("orderadd", {
			waiter: data["Name"],
			waiterphone: data["Phone"],
		})
	}
	*/
</script>

</body>
</html>