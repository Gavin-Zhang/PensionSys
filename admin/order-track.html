<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>
        新建工单
    </title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/index.css">
    <script src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/index.js"></script>
	<script type="text/javascript" src="../js/base.js"></script>

    <!--<style>
        .imgs{display: none;}
        .picture{display: none;}
    </style>-->

    <!--百度编辑器
    <script src="./ueditor/ueditor.config.js"></script>
    <script src="./ueditor/ueditor.all.min.js"></script>
    <script src="./ueditor/lang/zh-cn/zh-cn.js"></script>
	-->
<style type="text/css">

</style>
</head>
<body>
	<style>
        .container{
            height: 80px;
            solid white;
			background: white;
        }
        .dot{
            border:10px solid #cdcdcd;
            width: 10px;
            height: 10px;
            border-radius: 100px;
            background: none;
            margin: AUTO;
            margin-bottom: -15px;
        }
		.dot1{
            border:10px solid #00ffff;
            width: 10px;
            height: 10px;
            border-radius: 100px;
            background: none;
            margin: AUTO;
            margin-bottom: -15px;
        }
		.dot2{
            border:3px solid #cdcdcd;
            width: 10px;
            height: 10px;
            border-radius: 10px;
            background: none;
            margin: AUTO;
            margin-bottom: -8px;
        }
		.dot3{
            border:3px solid #00ffff;
            width: 10px;
            height: 10px;
            border-radius: 10px;
            background: none;
            margin: AUTO;
            margin-bottom: -8px;
        }
        .item{
            flex:5;
            border-bottom:2px solid #cdcdcd;
        }
		.item1{
            flex:5;
            border-bottom:2px solid white;
        }
		.item2{
            flex:5;
            border-bottom:2px solid #00ffff;
        }
    </style>
	
	<script id="container" type="text/html">
		<div style="display:flex;">
			<!-- 订单已创建 -->
			<div style="flex:1;display:flex">
				<div class="flex:1"></div>
				<div class="dot1"></div>
				<div class="item2"></div> 
			</div>
			<div style="flex:1;display:flex"> <!-- 待分派 -->
				<div class="item2"></div> 
				<div class="dot3"></div>
				{{#  if(d.OrderStatus === "待分派"){ }}
					<div class="item"></div> 
				{{#  } else { }}
					<div class="item2"></div> 
				{{#  } }} 
			</div>
			<!-- 订单已分派 -->
			<div style="flex:1;display:flex">
				{{#  if(d.OrderStatus === "待分派"){ }}
					<div class="item"></div>
					<div class="dot"></div>
					<div class="item"></div>
				{{#  } else { }}
					<div class="item2"></div>
					<div class="dot1"></div>
					<div class="item2"></div>
				{{#  } }} 
			</div>
			<div style="flex:1;display:flex"> <!-- 待服务 -->
				{{#  if(d.OrderStatus === "待分派"){ }}
					<div class="item"></div> 
					<div class="dot2"></div>
					<div class="item"></div> 
				{{#  } else { }}
					<div class="item2"></div> 
					<div class="dot3"></div>
					{{#  if(d.OrderStatus === "待分派" || d.OrderStatus === "待服务"){ }}
						<div class="item"></div> 
					{{#  } else { }}
						<div class="item2"></div> 
					{{#  } }} 
				{{#  } }} 
			</div>
			<!-- 服务已完成 -->
			<div style="flex:1;display:flex" id="dot_statue_2">
				{{#  if(d.OrderStatus === "待分派" || d.OrderStatus === "待服务"){ }}
					<div class="item"></div>
					<div class="dot"></div>
					<div class="item"></div>
				{{#  } else { }}
					<div class="item2"></div>
					<div class="dot1"></div>
					<div class="item2"></div>
				{{#  } }} 
			</div>
			<div style="flex:1;display:flex"> <!-- 待支付 -->
				{{#  if(d.OrderStatus === "待分派" || d.OrderStatus === "待服务"){ }}
					<div class="item"></div> 
					<div class="dot2"></div>
					<div class="item"></div> 
				{{#  } else { }}
					<div class="item2"></div> 
					<div class="dot3"></div>
					{{#  if(d.OrderStatus === "待分派" || d.OrderStatus === "待服务" || d.OrderStatus === "待支付"){ }}
						<div class="item"></div> 
					{{#  } else { }}
						<div class="item2"></div> 
					{{#  } }} 
				{{#  } }} 
			</div>
			<!-- 订单已完成 -->
			<div style="flex:1;display:flex" id="dot_statue_3">
				{{#  if(d.OrderStatus !== "已完成"){ }}
					<div class="item"></div>
					<div class="dot"></div>
				{{#  } else { }}
					<div class="item2"></div>
					<div class="dot1"></div>
				{{#  } }} 
				<div class="flex:1"></div>
			</div>
		</div>
		<div style="display:flex;margin-top:25px;">
			<div style="flex:1;display:flex">
				<div class="flex:1"></div>
				<div class="layui-font-14 layui-font-blue">已下单</div>
				<div class="item1"></div>
			</div>
			<div style="flex:1;display:flex">
				<div class="item1"></div>
				{{#  if(d.OrderStatus === "待分派"){ }}
					<div class="layui-font-12 layui-font-blue">待分派</div>
				{{#  } }} 
				<div class="item1"></div>
			</div>
			<!-- -->
			<div style="flex:1;display:flex">
				<div class="item1"></div>
				{{#  if(d.OrderStatus === "待分派"){ }}
				<div class="layui-font-14 layui-font-gray">已分派</div>
				{{#  } else { }}
				<div class="layui-font-14 layui-font-blue">已分派</div>
				{{#  } }} 
				<div class="item1"></div>
			</div>
			<div style="flex:1;display:flex">
				<div class="item1"></div>
				{{#  if(d.OrderStatus === "待服务"){ }}
				<div class="layui-font-12 layui-font-blue">待服务</div>
				{{#  } }} 
				<div class="item1"></div>
			</div>
			<!-- -->
			<div style="flex:1;display:flex">
				<div class="item1"></div>
				{{#  if(d.OrderStatus === "待分派" || d.OrderStatus === "待服务"){ }}
				<div class="layui-font-14 layui-font-gray">已服务</div>
				{{#  } else { }}
				<div class="layui-font-14 layui-font-blue">已服务</div>
				{{#  } }} 
				<div class="item1"></div>
			</div>
			<div style="flex:1;display:flex">
				<div class="item1"></div>
				{{#  if(d.OrderStatus === "待支付"){ }}
				<div class="layui-font-12 layui-font-blue">待支付</div>
				{{#  } }} 
				<div class="item1"></div>
			</div>
			<!-- -->
			<div style="flex:1;display:flex">
				<div class="item1"></div>
				{{#  if(d.OrderStatus !== "已完成"){ }}
				<div class="layui-font-14 layui-font-gray">已完成</div>
				{{#  } else { }}
				<div class="layui-font-14 layui-font-blue">已完成</div>
				{{#  } }} 
				<div class="flex:1"></div>
			</div>
		</div>
		<div style="display:flex;margin-top:5px;">
			<div style="flex:1;display:flex">
				<div class="flex:1"></div>
				<div class="layui-font-14 layui-font-blue">{{= d.Created }}</div>
				<div class="item1"></div>
			</div>
			<div style="flex:1;display:flex">
					<div class="item1"></div>
					<div class="item1"></div>
			</div>
			<div style="flex:1;display:flex">
				{{#  if(d.OrderStatus !== "待分派"){ }}
					<div class="item1"></div>
					<div class="layui-font-14 layui-font-blue">{{= d.AssignTime }}</div>
					<div class="item1"></div>
				{{#  } }} 
			</div>
			<div style="flex:1;display:flex">
					<div class="item1"></div>
					<div class="item1"></div>
			</div>
			<div style="flex:1;display:flex">
				{{#  if(d.OrderStatus !== "待分派" && d.OrderStatus !== "待服务"){ }}
					<div class="item1"></div>
					<div class="layui-font-14 layui-font-blue">{{= d.EndTime }}</div>
					<div class="item1"></div>
				{{#  } }} 
			</div>
			<div style="flex:1;display:flex">
					<div class="item1"></div>
					<div class="item1"></div>
			</div>
			<div style="flex:1;display:flex">
				{{#  if(d.OrderStatus === "已完成"){ }}
					<div class="item1"></div>
					<div class="layui-font-14 layui-font-blue">{{= d.FinishTime }}</div>
					<div class="flex:1"></div>
				{{#  } }} 
			</div>
		</div>
	</script>
	
	<script id="waiterinfo" type="text/html">
		{{#  if(d.OrderStatus === "待分派"){ }}
			<div class="layui-row layui-col-space5">
				<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					<div class="layui-col-xs10 layui-col-sm10 layui-col-md10">
						<label for="waiter" class="layui-form-label">
							<span class="x-red">*</span>服务人员</label>
						<div class="layui-input-block">
							<input type="text" id="waiter" name="waiter" lay-verify="required" disabled="disabled" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs2 layui-col-sm2 layui-col-md2">
						<button class="layui-btn layui-btn-normal" type="button" onclick="onSelWaiter();">
							<i class="layui-icon">&#xe615;</i>
						</button>
					</div>
				</div>
				<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					<label for="waiterphone" class="layui-form-label">
						<span class="x-red">*</span>联系电话</label>
					<div class="layui-input-block">
						<input type="text" class="layui-input" id="waiterphone" name="waiterphone" lay-verify="required|number" disabled="disabled">
					</div>
				</div>
			</div>
		{{#  } else { }}
			<div class="layui-row layui-col-space5">
				<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					<label for="waiter" class="layui-form-label">服务人员</label>
					<div class="layui-input-block">
						<input type="text" id="waiter" name="waiter" disabled="disabled" class="layui-input">
					</div>
				</div>
				<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					<label for="waiterphone" class="layui-form-label">联系电话</label>
					<div class="layui-input-block">
						<input type="text" class="layui-input" id="waiterphone" name="waiterphone" disabled="disabled">
					</div>
				</div>
			</div>
		{{#  } }} 
	</script>
	
	<script id="servicetime" type="text/html">
		{{#  if(d.OrderStatus === "待服务"){ }}
			<div class="layui-row layui-col-space5">
				<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					<label for="waiter" class="layui-form-label">
						<span class="x-red">*</span>服务时间</label>
					<div class="layui-input-inline"id="servicetimes">
						<input type="text" autocomplete="off" id="servicebegin" name="servicebegin" lay-verify="required" class="layui-input" placeholder="开始日期">
					</div>
					<div class="layui-form-mid">-</div>
					<div class="layui-input-inline">
						<input type="text" autocomplete="off" id="serviceend" name="serviceend" lay-verify="required" class="layui-input" placeholder="结束日期">
					</div>
				</div>
			</div>
		{{#  } else if(d.OrderStatus === "待支付" || d.OrderStatus === "已完成"){ }}
			<div class="layui-row layui-col-space5">
				<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					<label for="servicebegin" class="layui-form-label">服务时间</label>
					<div class="layui-input-inline" id="servicetimes">
						<input type="text" autocomplete="off" name="servicebegin" disabled="disabled" class="layui-input" placeholder="开始日期">
					</div>
					<div class="layui-form-mid">-</div>
					<div class="layui-input-inline">
						<input type="text" autocomplete="off" name="serviceend" disabled="disabled" class="layui-input" placeholder="结束日期">
					</div>
				</div>
				{{#  if(d.OrderStatus === "待支付"){ }}
				<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					<label for="paymenttime" class="layui-form-label"><span class="x-red">*</span>支付日期</label>
					<div class="layui-input-inline" id="servicetimes">
						<input type="text" autocomplete="off" id="paymenttime" name="paymenttime" lay-verify="required" class="layui-input" placeholder="支付日期">
					</div>
				</div>
				{{#  } else if(d.OrderStatus === "已完成"){ }}
				<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					<label for="paymenttime" class="layui-form-label">支付日期</label>
					<div class="layui-input-inline" id="servicetimes">
						<input type="text" autocomplete="off" name="paymenttime" disabled="disabled" class="layui-input" placeholder="支付日期">
					</div>
				</div>
				{{#  } }} 
			</div>
		{{#  } }} 
	</script>
	
	<script id="faretpl" type="text/html">
		{{#  if (d.ConsumptionType !== "政府购买" && d.OrderStatus === "待支付") { }}
			<div class="layui-row layui-col-space5">
				<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					<label for="fare" class="layui-form-label">
						<span class="x-red">*</span>服务费用</label>
					<div class="layui-input-block">
						<input type="text" id="charge" name="charge" value="0" lay-verify="required|number" class="layui-input">
					</div>
				</div>
				<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					<label class="layui-form-label">
						<span class='x-red'>*</span>支付方式
					</label>
					<div class="layui-input-block">
						<select name="paymenttype" id="paymenttype" lay-verify="required" >
						</select>
					</div>
				</div>
			</div>
		{{#  } else if (d.ConsumptionType !== "政府购买" && d.OrderStatus === "已完成"){ }}
			<div class="layui-row layui-col-space5">
				<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					<label for="fare" class="layui-form-label">服务费用</label>
					<div class="layui-input-block">
						<input type="text" name="charge" value="0" disabled="disabled" class="layui-input">
					</div>
				</div>
				<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					<label for="fare" class="layui-form-label">支付方式</label>
					<div class="layui-input-block">
						<input type="text" name="paymenttype" value="0" disabled="disabled" class="layui-input">
					</div>
				</div>
			</div>
		{{#  } }} 
	</script>
	
	<script id="otherfaretpl" type="text/html">
		{{#  if(d.ConsumptionType !== "政府购买"){ }}
			{{#  if(d.OrderStatus === "待支付"){ }}
				<div class="layui-row layui-col-space1">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="fare" class="layui-form-label">
							<span class="x-red">*</span>车费</label>
						<div class="layui-input-block">
							<input type="text" id="fare" name="fare" value="0" lay-verify="required|number" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="highrise" class="layui-form-label">
							<span class="x-red">*</span>高层费用</label>
						<div class="layui-input-block">
							<input type="text" id="highrise" name="highrise" value="0" lay-verify="required|number" class="layui-input">
						</div>
					</div>
				</div>
			{{#  } else if(d.OrderStatus === "已完成"){ }}
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="fare" class="layui-form-label">车费</label>
						<div class="layui-input-block">
							<input type="text" id="fare" name="fare" value="0" disabled="disabled" lay-verify="required|number" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="highrise" class="layui-form-label">高层费用</label>
						<div class="layui-input-block">
							<input type="text" id="highrise" name="highrise" value="0" disabled="disabled" lay-verify="required|number" class="layui-input">
						</div>
					</div>
				</div>
			{{#  } }} 
		{{#  } }} 
	</script>
	
	<div class="layui-fluid">
		<form class="layui-form layui-form-pane" id="ordertrack" lay-filter="ordertrack">
			<input type="hidden" id="orderdata">
			<div class="layui-form-item " data-filtered="filtered">
				<div data-filtered="filtered">
					<div class="layui-panel" data-filtered="filtered">
						<div style="padding: 30px;" data-filtered="filtered">
							<div class="container" id="containerdiv">
							</div>
						</div>
					</div>   
				</div>
			</div>   
			<div class="layui-form-item">
				<div class="layui-row layui-col-space5">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="name" class="layui-form-label">老人</label>
						<div class="layui-input-block">
							<input type="text" name="name" disabled="disabled" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="phone" class="layui-form-label">联系方式
						</label>
						<div class="layui-input-block">
							<input type="text" name="phone" disabled="disabled" class="layui-input">
						</div>
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-row layui-col-space5">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="idx" class="layui-form-label">订单编号</label>
						<div class="layui-input-block">
							<input type="text" id="idx" name="idx" disabled="disabled" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
						<label for="sex" class="layui-form-label">性别</label>
						<div class="layui-input-block">
							<input type="text" name="sex" disabled="disabled" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
						<label for="age" class="layui-form-label">年龄</label>
						<div class="layui-input-block">
							<input type="text" name="age" disabled="disabled" class="layui-input">
						</div>
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<label for="addr" class="layui-form-label">地址</label>
				<div class="layui-input-block">
					<input id="addr" name="addr" disabled="disabled" class="layui-input">
				</div>
			</div>
			<div class="layui-form-item">
				<label for="consumptiontype" class="layui-form-label">消费类型</label>
				<div class="layui-input-block">
					<input id="consumptiontype" name="consumptiontype" disabled="disabled" class="layui-input">
				</div>
			</div>
			<div class="layui-form-item" id="waiterinfodiv">
				<!--
				<div class="layui-row layui-col-space5">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<div class="layui-col-xs10 layui-col-sm10 layui-col-md10">
							<label for="waiter" class="layui-form-label">
								<span class="x-red">*</span>服务人员</label>
							<div class="layui-input-block">
								<input type="text" id="waiter" name="waiter" disabled="disabled" class="layui-input">
							</div>
						</div>
						<div class="layui-col-xs2 layui-col-sm2 layui-col-md2">
							<button class="layui-btn layui-btn-normal" type="button" onclick="onSelWaiter();">
								<i class="layui-icon">&#xe615;</i>
							</button>
						</div>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="waiterphone" class="layui-form-label">
							<span class="x-red">*</span>联系电话</label>
						<div class="layui-input-block">
							<input type="text" class="layui-input" id="waiterphone" name="waiterphone" disabled="disabled">
						</div>
					</div>
				</div>
				-->
			</div>
			<div class="layui-form-item" id="servicetimediv">
				<!--
				<label for="waiter" class="layui-form-label">
					<span class="x-red">*</span>服务时间</label>
				<div class="layui-input-inline">
					<input type="text" autocomplete="off" id="test-startDate-1" class="layui-input" placeholder="开始日期">
				</div>
				<div class="layui-form-mid">-</div>
				<div class="layui-input-inline">
					<input type="text" autocomplete="off" id="test-endDate-1" class="layui-input" placeholder="结束日期">
				</div>
				-->
			</div>
			<div class="layui-form-item" id="farediv">
				<!--
				<div class="layui-row layui-col-space5">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="fare" class="layui-form-label">
							<span class="x-red">*</span>服务费用</label>
						<div class="layui-input-block">
							<input type="text" id="charge" name="charge" value="0" lay-verify="required|number" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label class="layui-form-label">
							<span class='x-red'>*</span>支付方式
						</label>
						<div class="layui-input-block">
							<select name="paymenttype" id="paymenttype" lay-verify="required" >
							</select>
						</div>
					</div>
				</div>
				-->
			</div>
			<div class="layui-form-item" id="otherfarediv">
				<!--
				<div class="layui-row layui-col-space1">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="fare" class="layui-form-label">
							<span class="x-red">*</span>车费</label>
						<div class="layui-input-block">
							<input type="text" id="fare" name="fare" value="0" required="" lay-verify="number" class="layui-input">
						</div>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<label for="highrise" class="layui-form-label">
							<span class="x-red">*</span>高层费用</label>
						<div class="layui-input-block">
							<input type="text" id="highrise" name="highrise" value="0" required="" lay-verify="number" class="layui-input">
						</div>
					</div>
				</div>
				-->
			</div>

			<div class="layui-form-item">
				<button class="layui-btn layui-btn-fluid" id="ok" type="button" lay-filter="add" lay-submit="">确定</button>
			</div>
		</form>
</div>

<!--工具栏模板-->
<script type="text/html" id="contactstools">
  <div class="layui-btn-group">
    <button class="layui-btn layui-btn-primary layui-btn layui-btn-sm" id="contacts_add">
		<i class="layui-icon"  style="font-size: 20px">&#xe61f;</i>
	</button>
	<!--<button class="layui-btn layui-btn-primary layui-btn layui-btn-sm" onclick="onRefresh();" lay-event="refresh"><i class="layui-icon"  style="font-size: 20px">&#xe669;</i></button>-->
  </div>
</script>

<script>

    layui.use(['element','layer', 'form', 'table', 'laydate', 'laytpl'], function(){
        var  $ = layui.jquery;//jquery
        var lement = layui.element;//面包导航
        var layer = layui.layer;//弹出层
        var form = layui.form;
		var table = layui.table;
		var laydate = layui.laydate;
		var laytpl = layui.laytpl;
		
		var orderdata = layui.sessionData("order-list")["track"];
		var getTpl = container.innerHTML;
		var view = document.getElementById('containerdiv');
		laytpl(getTpl).render(orderdata, function(html){
			view.innerHTML = html;
		})
		
		// 服务人员
		var waiterinfo_tpl = waiterinfo.innerHTML
		var waiterinfo_div = document.getElementById('waiterinfodiv');
		laytpl(waiterinfo_tpl).render(orderdata, function(html){
			waiterinfo_div.innerHTML = html;
		})
		
		// 服务时间
		var servicetime_tpl = servicetime.innerHTML
		var servicetime_div = document.getElementById('servicetimediv');
		laytpl(servicetime_tpl).render(orderdata, function(html){
			servicetime_div.innerHTML = html;
		})
		
		// 收费
		var fare_tpl = faretpl.innerHTML
		var fare_div = document.getElementById('farediv')
		laytpl(fare_tpl).render(orderdata, function(html){
			fare_div.innerHTML = html;
		})
		
		// 其他收费
		var otherfare_tpl = otherfaretpl.innerHTML
		var othefare_div = document.getElementById('otherfarediv');
		laytpl(otherfare_tpl).render(orderdata, function(html){
			othefare_div.innerHTML = html;
		})
		
		$.ajaxSetup({
			headers: {'Access-Control-Allow-Origin' : Domain,},
			xhrFields: {withCredentials: true},
		});
		
		intiServiceTime(orderdata);
		initPaymentType(orderdata);
		initOtherFare(orderdata);
		initPaymentTime(orderdata);
		initButtion(orderdata);

		form.val("ordertrack", {
			"name": orderdata.Name,
			"phone": orderdata.Phone,
			"idx": orderdata.Idx,
			"age": GetAge(orderdata.ChinaId),
			"sex": GetSex(orderdata.ChinaId),
			"addr": orderdata.Addr,
			"waiter": orderdata.Waiter,
			"waiterphone": orderdata.WaiterPhone,
			"consumptiontype": orderdata.ConsumptionType})

        //监听提交
        form.on('submit(add)', function(data){
			console.log(layui._typeof(data.field))
			var orderdata = layui.sessionData("order-list")["track"];
			if (orderdata.OrderStatus === "待分派") {
				$.ajax({
					type: "post",
					url: BasePath + '/assignorder',
					data: data.field,
					dataType: "json",
					headers: {'Access-Control-Allow-Origin' : Domain,},
					xhrFields: {withCredentials: true},
					success: function(data){
						console.log(data)
						if(data.code==0){
							layer.msg("分派成功", {icon: 6,time:2000},function () {
								//window.parent.location.reload();
								//var index = parent.layer.getFrameIndex(window.name);
								//parent.layer.close(index);
								GetOrderData()
							});
						}else if(data.code==1001) {
							parent.location.href = "../index.html";
						}else{
							layer.msg(data.msg, {icon:5,time:5000});
						}
					}
				});
			} else if (orderdata.OrderStatus === "待服务") {
				$.ajax({
					type: "post",
					url: BasePath + '/orderserviced',
					data: data.field,
					dataType: "json",
					headers: {'Access-Control-Allow-Origin' : Domain,},
					xhrFields: {withCredentials: true},
					success: function(data){
						console.log(data)
						if(data.code==0){
							layer.msg("设置成功", {icon: 6,time:2000},function () {
								//window.parent.location.reload();
								//var index = parent.layer.getFrameIndex(window.name);
								//parent.layer.close(index);
								GetOrderData()
							});
						}else if(data.code==1001) {
							parent.location.href = "../index.html";
						}else{
							layer.msg(data.msg, {icon:5,time:5000});
						}
					}
				});
			} else if (orderdata.OrderStatus === "待支付") {
				$.ajax({
					type: "post",
					url: BasePath + '/orderpayment',
					data: data.field,
					dataType: "json",
					headers: {'Access-Control-Allow-Origin' : Domain,},
					xhrFields: {withCredentials: true},
					success: function(data){
						console.log(data)
						if(data.code==0){
							layer.msg("设置成功", {icon: 6,time:2000},function () {
								//window.parent.location.reload();
								//var index = parent.layer.getFrameIndex(window.name);
								//parent.layer.close(index);
								GetOrderData()
							});
						}else if(data.code==1001) {
							parent.location.href = "../index.html";
						}else{
							layer.msg(data.msg, {icon:5,time:5000});
						}
					}
				});
			}
        });
		
    })
	
	function intiServiceTime(orderdata) {
		if (orderdata.OrderStatus === "待服务") {
			//日期范围
			layui.laydate.render({
				elem: '#servicetimes'
				,type: 'datetime'
				//设置开始日期、日期日期的 input 选择器
				//数组格式为 2.6.6 开始新增，之前版本直接配置 true 或任意分割字符即可
				,range: ['#servicebegin', '#serviceend']
			});
		} else {
			layui.form.val("ordertrack", {
				servicebegin: orderdata.BeginTime,
				serviceend: orderdata.EndTime
			})
		}
	}
	
	function initPaymentType(orderdata) {
		if (orderdata.ConsumptionType !== "政府购买" && orderdata.OrderStatus === "待支付") {
			$.ajax({
				type: "post",
				url: BasePath + '/getpaymenttype',
				dataType: "json",
				headers: {'Access-Control-Allow-Origin' : Domain,},
				xhrFields: {withCredentials: true},
				success: function(data){
					console.log(data)
					if(data.code==0){
						for (var i=0;i<data.data[0].length;i++) {
							$("#paymenttype").append(new Option(data.data[0][i]["Type"], data.data[0][i]["Type"]))
						}
						layui.form.render('select');
					}else if(data.code==1001) {
						parent.location.href = "../index.html";
					}else{
						layer.msg(data.msg, {icon:5,time:5000});
					}
				}
			});
		} else if (orderdata.ConsumptionType !== "政府购买" && 
					(orderdata.OrderStatus == "待支付" || orderdata.OrderStatus === "已完成")) {
			layui.form.val("ordertrack", {
				paymenttype: orderdata.PaymentType,
			})
		}
	}

	function initOtherFare(orderdata) {
		if (orderdata.ConsumptionType !== "政府购买" && 
			(orderdata.OrderStatus == "待支付" || orderdata.OrderStatus === "已完成")) {
			layui.form.val("ordertrack", {
				fare: orderdata.Fare,
				highrise: orderdata.HighRise
			})
		}
	}
	
	function initPaymentTime(orderdata) {
		if (orderdata.OrderStatus === "待支付") {
			layui.laydate.render({
				elem: '#paymenttime'
				,type: 'date'
				,value: new Date()
			});
		} else if (orderdata.OrderStatus === "已完成") {
			layui.form.val("ordertrack", {
				paymenttime: orderdata.PaymentTime.substr(0,10)
			})
		}
	}
	
	function initButtion(orderdata) {
		if (orderdata.OrderStatus == "已完成") {
			document.getElementById('ok').style.display = 'none';
		} else {
			document.getElementById('ok').style.display = 'block';
		}
	}
	
	function onSelWaiter() {
		layer.open({
			type: 2,
			area: ['800px', '400px'],
			fixed: false, //不固定
			maxmin: true,
			title: "选择服务人员",
			content: 'worker-select.html',
			success:function(layero,index){
			
			}
		});
	}
</script>

<script>
	function GetOrderData(orderdata) {
		var orderdata = layui.sessionData("order-list")["track"];
		var data = {page:"1", limit:"1", idx:orderdata.Idx};
		$.ajax({
			type: "post",
			url: BasePath + '/getorders',
			data: data,
			dataType: "json",
			headers: {'Access-Control-Allow-Origin' : Domain,},
			xhrFields: {withCredentials: true},
			success: function(data){
				console.log(data)
				if(data.code==0){
					console.log(data.data[0][0])
					layui.sessionData("order-list", {key:"track", value:data.data[0][0]})
					location.reload();
				}else if(data.code==1001) {
					parent.location.href = "../index.html";
				}else{
					layer.msg(data.msg, {icon:5,time:5000});
				}
			}
		});
	}
	
	
	function DoSelectWorker(data) {
		console.log(data)
		layui.form.val("ordertrack", {
			waiter: data["Name"],
			waiterphone: data["Phone"],
		})
	}
</script>

</body>
</html>